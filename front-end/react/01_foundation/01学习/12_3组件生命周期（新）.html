<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>12_1组件生命周期</title>
</head>
<body>
<div id="test"></div>

<!--引入react核心库，多全局变量 REACT-->
<script type="text/javascript" src="js@17/react.development.js"></script>
<!--引入react-dom，用于支持react操作DOM，多全局变量 REACTDOM-->
<script type="text/javascript" src="js@17/react-dom.development.js"></script>
<!--引入babel，用于将jsx转为js-->
<script type="text/javascript" src="js@17/babel.min.js"></script>
<!--引入prop=types，用于对组件标签属性进行限制 PropTypes-->
<script type="text/javascript" src="js@17/prop-types.js"></script>
<!--声明后续的内容为JSX语法，通过babel使用JSX语法-->
<script type="text/babel">
    class Count extends React.Component {
        /**
         * 1. 初始化阶段：由ReactDOM.render()触发---初次渲染
         *      1. constructor()
         *      2. getDerivedStateFromProps()
         *      3. render()
         *      4. componentDidMount()
         * 2. 更新阶段：由组件内部this.setState()或者父组件重新render触发
         *      1. getDerivedStateFromProps()
         *      2. shouldComponentUpdate()
         *      3. render()
         *      4. componentDidMount()
         * 3. 卸载组件：由ReactDOM.unmountComponentAtNode()触发
         *      1. componentWillUnmount()
         */
        constructor(props) {
            console.log('count-constructor')
            super(props);
            this.state = {count: 0}
        }

        // state = {count: 0}

        add = () => {
            const {count} = this.state
            this.setState({count: count + 1})
        }

        death = () => {
            ReactDOM.unmountComponentAtNode(document.getElementById('test'))
        }

        force = () => {
            this.forceUpdate()
        }

        // 如state中的任何值都来自props，可以使用此方法
        static getDerivedStateFromProps(props){
            console.log(props)
            console.log('count-getDerivedStateFromProps')
            return {count:19}
        }

        getSnapshotBeforeUpdate(){
            console.log('count-getSnapshotBeforeUpdate')
            return 'snapshot'
        }

        componentDidMount() {
            console.log('count-componentDidMount')
        }

        componentWillUnmount() {
            console.log('count-componentWillUnmount')
        }

        // 默认需要更新，如果返回false则不会更新
        shouldComponentUpdate() {
            console.log('count-shouldComponentUpdate')
            return true
        }

        componentDidUpdate(preProps,preState,snapshotVal) {
            console.log('count-componentDidUpdate',preProps,preState)
        }


        render() {
            console.log('count-render')
            const {count} = this.state
            return (<div>
                <h2>total sum is {count}</h2>
                <button onClick={this.add}>click to count 1</button>
                <button onClick={this.death}>unmount the component</button>
                <button onClick={this.force}>force update the component</button>
            </div>)
        }
    }


    ReactDOM.render(<Count count={199}/>, document.getElementById('test'))
</script>
</body>
</html>